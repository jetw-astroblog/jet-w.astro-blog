---
import { getCollection } from 'astro:content';
import PageLayout from '@jet-w/astro-blog/layouts/PageLayout.astro';
import { i18nConfig as virtualI18nConfig } from 'virtual:astro-blog-i18n';
import { defaultI18nConfig } from '../../config/i18n';
import { getLocaleFromPath, getLocaleConfig, getLocalePrefix } from '../../utils/i18n';

// Get i18n config
const i18nConfig = virtualI18nConfig || defaultI18nConfig;
const currentLocale = getLocaleFromPath(Astro.url.pathname, i18nConfig);
const localeConfig = getLocaleConfig(currentLocale, i18nConfig);
const ui = localeConfig.ui;
const base = import.meta.env.BASE_URL;
const localePrefix = getLocalePrefix(currentLocale, i18nConfig, base);

// è·å–æ‰€æœ‰éè‰ç¨¿çš„ slides
const slides = (await getCollection('slides', ({ data }) => !data.draft))
  .sort((a, b) => {
    const dateA = a.data.pubDate ? new Date(a.data.pubDate).getTime() : 0;
    const dateB = b.data.pubDate ? new Date(b.data.pubDate).getTime() : 0;
    return dateB - dateA;
  });

function formatDate(date: Date | undefined): string {
  if (!date) return '';
  return new Date(date).toLocaleDateString('zh-CN', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
---

<PageLayout title={ui.slides} description={ui.slidesList} showSidebar={false} i18nConfig={i18nConfig}>
  <!-- é¢åŒ…å±‘å¯¼èˆª -->
  <nav class="flex items-center space-x-2 text-sm text-slate-600 dark:text-slate-400 mb-8">
    <a href={`${localePrefix}/`} class="hover:text-primary-500 transition-colors">{ui.home}</a>
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
    </svg>
    <span class="text-slate-900 dark:text-slate-100">{ui.slides}</span>
  </nav>

  <div class="slides-list-page">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100 mb-2">
        {ui.slides}
      </h1>
      <p class="text-slate-600 dark:text-slate-400">
        {ui.slidesList}
      </p>
    </header>

    {slides.length === 0 ? (
      <div class="text-center py-16 text-slate-500 dark:text-slate-400">
        <div class="text-6xl mb-4">ğŸ“­</div>
        <p>{ui.noPostsFound}</p>
        <p class="text-sm mt-2">content/slides/</p>
      </div>
    ) : (
      <div class="grid gap-6 md:grid-cols-2">
        {slides.map((slide) => (
          <a
            href={`${localePrefix}/slides/${slide.id}`}
            class="slide-card group block p-6 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-primary-500 dark:hover:border-primary-500 transition-all hover:shadow-lg hover:-translate-y-1"
          >
            <div class="flex items-start justify-between mb-3">
              <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
                {slide.data.title}
              </h2>
              <span class="flex-shrink-0 ml-2 px-2 py-1 text-xs bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded">
                {slide.data.theme || 'black'}
              </span>
            </div>

            {slide.data.description && (
              <p class="text-slate-600 dark:text-slate-400 text-sm mb-4 line-clamp-2">
                {slide.data.description}
              </p>
            )}

            <div class="flex items-center justify-between text-sm text-slate-500 dark:text-slate-400">
              <div class="flex items-center gap-4">
                {slide.data.pubDate && (
                  <span class="flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    {formatDate(slide.data.pubDate)}
                  </span>
                )}
                {slide.data.author && (
                  <span class="flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    {slide.data.author}
                  </span>
                )}
              </div>

              <span class="flex items-center gap-1 text-primary-600 dark:text-primary-400 group-hover:translate-x-1 transition-transform">
                æŸ¥çœ‹
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </span>
            </div>

            {slide.data.tags && slide.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-slate-100 dark:border-slate-700">
                {slide.data.tags.map((tag: string) => (
                  <span class="px-2 py-0.5 text-xs bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded-full">
                    #{tag}
                  </span>
                ))}
              </div>
            )}
          </a>
        ))}
      </div>
    )}

    <!-- ä½¿ç”¨è¯´æ˜ -->
    <div class="mt-12 p-6 bg-slate-50 dark:bg-slate-800/50 rounded-xl">
      <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4">å¿«é€Ÿå¼€å§‹</h3>
      <div class="prose prose-sm dark:prose-invert max-w-none">
        <ol class="list-decimal list-inside space-y-2 text-slate-600 dark:text-slate-400">
          <li>åœ¨ <code class="px-1.5 py-0.5 bg-slate-200 dark:bg-slate-700 rounded text-sm">content/slides/</code> ç›®å½•ä¸‹åˆ›å»º Markdown æ–‡ä»¶</li>
          <li>ä½¿ç”¨ <code class="px-1.5 py-0.5 bg-slate-200 dark:bg-slate-700 rounded text-sm">---</code> åˆ†éš”æ°´å¹³å¹»ç¯ç‰‡</li>
          <li>ä½¿ç”¨ <code class="px-1.5 py-0.5 bg-slate-200 dark:bg-slate-700 rounded text-sm">----</code> åˆ†éš”å‚ç›´å¹»ç¯ç‰‡</li>
          <li>æ”¯æŒä»£ç é«˜äº®ã€æ•°å­¦å…¬å¼å’Œ Mermaid å›¾è¡¨</li>
        </ol>
      </div>

      <div class="mt-4 flex flex-wrap gap-2">
        <span class="text-sm text-slate-500 dark:text-slate-400">å¯ç”¨ä¸»é¢˜:</span>
        {['black', 'white', 'league', 'beige', 'night', 'serif', 'simple', 'solarized'].map((t) => (
          <span class="px-2 py-0.5 text-xs bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded">
            {t}
          </span>
        ))}
      </div>
    </div>
  </div>
</PageLayout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
